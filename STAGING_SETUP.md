# Configuração MCP Server para Staging/Homologação

## ✅ **STATUS: PRONTO PARA STAGING**

O MCP Server foi configurado com suporte completo ao ambiente de staging conforme sua configuração MCP.

## 📋 **Configuração MCP (claude_desktop_config.json)**

```json
{
  "mcpServers": {
    "filazero-test": {
      "command": "node",
      "args": ["C:\\Users\\ovg19\\Downloads\\FilazeroMcpServer\\filazero-mcp-nodejs\\dist\\index.js"],
      "cwd": "C:\\Users\\ovg19\\Downloads\\FilazeroMcpServer\\filazero-mcp-nodejs",
      "env": {
        "NODE_ENV": "staging",
        "FILAZERO_API_URL": "https://api.staging.filazero.net/",
        "LOG_LEVEL": "debug"
      }
    }
  }
}
```

## 🔧 **Configurações Aplicadas**

### Environment Dinâmico
- ✅ **NODE_ENV**: `staging` → Habilita configurações de staging
- ✅ **FILAZERO_API_URL**: `https://api.staging.filazero.net/` → API de staging
- ✅ **LOG_LEVEL**: `debug` → Logs detalhados

### Providers para Staging
```javascript
artesano: 460    // Dev/Staging ID
boticario: 358   // Dev/Staging ID  
nike: 356        // Dev/Staging ID
phoneNoel: 357   // Dev/Staging ID
queueNoel: 357   // Dev/Staging ID
```

### reCAPTCHA Bypass
- ✅ **Automaticamente habilitado** em staging
- ✅ **Tokens válidos** gerados (formato: `BYPASS_V3_*_MCP`)
- ✅ **Duração**: 1 hora por token

## 🧪 **Validação da Configuração**

### Teste Realizado
```bash
🧪 TESTE DE CONFIGURAÇÃO STAGING
✅ Configuração dinâmica: OK
✅ API URL correta: OK  
✅ Bypass habilitado: OK
✅ Providers staging: OK
✅ Token bypass gerado: BYPASS_V3_eyJ2ZXJzaW9uIjoiMy4w...
✅ reCAPTCHA service usando bypass em staging
```

### Logs Esperados no MCP
```
🚀 Filazero MCP Server (Node.js) iniciado!
📡 Ambiente: staging
🔗 API URL: https://api.staging.filazero.net/
📊 Log Level: debug
🛠️ Total de tools: 11

🔐 Generating reCAPTCHA token for action: create_ticket
🎯 Using BYPASS reCAPTCHA service (ENV: staging)
🔐 Generating bypass token for action: create_ticket, origin: mcp-server
✅ Generated bypass token (length: 218)
```

## 🎯 **Funcionalidades Disponíveis**

### Tools MCP
1. `get_terminal` - Buscar terminal por chave
2. `create_ticket` - Criar ticket (COM BYPASS)
3. `get_ticket` - Buscar ticket por ID
4. `cancel_ticket` - Cancelar ticket
5. `checkin_ticket` - Check-in com smart code
6. `confirm_presence` - Confirmar presença
7. `get_queue_position` - Posição na fila
8. `get_ticket_prevision` - Previsão de atendimento
9. `update_feedback` - Atualizar feedback
10. `get_service` - Buscar serviço
11. `get_company_template` - Template da empresa

### Bypass reCAPTCHA
- **Automático**: Não requer reCAPTCHA real em staging
- **Formato**: `BYPASS_V3_{dados}_{MCP}`  
- **Validação**: Chave `mcp_filazero_2025`
- **Segurança**: Tokens com timestamp e assinatura

## 🚨 **Observações Importantes**

### API de Staging
- **URL**: `https://api.staging.filazero.net/`
- **Status**: Precisa ter bypass implementado para funcionar 100%
- **Fallback**: Se API staging não tiver bypass, pode haver erro 2155

### Dados de Teste
- **Chave terminal**: `1d1373dcf045408aa3b13914f2ac1076`
- **Provider IDs**: Usar IDs de desenvolvimento (460, 358, etc.)
- **Browser UUID**: `f3024fb3-8b10-4d4d-8d93-14c40d98b67d`

### Logs
- **Nível**: Debug habilitado
- **Output**: Console + arquivo de log
- **Formato**: Timestamp + nível + mensagem

## 🔄 **Troubleshooting**

### Se erro reCAPTCHA (2155) em staging:
1. Verificar logs: deve mostrar "Using BYPASS reCAPTCHA service"
2. API staging pode não ter bypass implementado
3. Aguardar deploy da API com bypass

### Se provider não encontrado:
1. Usar IDs de development/staging (460, 358, etc.)
2. Verificar se terminal existe no ambiente staging

### Se conexão falha:
1. Verificar URL: `https://api.staging.filazero.net/`
2. Testar acesso manual à API
3. Verificar rede/firewall

## 🎉 **Pronto para Usar!**

O MCP Server está **100% configurado** para staging com:
- ✅ Configuração dinâmica por ambiente
- ✅ API staging correta 
- ✅ Bypass reCAPTCHA habilitado
- ✅ Provider IDs adequados
- ✅ Logs detalhados

**Pode usar normalmente no Claude Desktop com a configuração fornecida!** 🚀